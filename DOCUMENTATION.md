# Документация проекта

## Структура проекта

```
.
├── src/                    # Исходный код проекта
│   ├── check_data.py      # Проверка загруженных данных
│   ├── check_vectors.py   # Проверка векторов
│   ├── check_similarities.py # Проверка сходства
│   ├── check_normalized_texts.py # Проверка нормализованных текстов
│   ├── data_loader.py     # Загрузка данных
│   ├── data_processor.py  # Обработка данных (полный цикл)
│   ├── db.py              # Работа с базой данных
│   ├── download_nltk_data.py # Загрузка данных NLTK
│   ├── rubert_vectorizer.py # Векторизатор ruBERT
│   ├── schema.py          # Схема базы данных
│   ├── text_processor.py  # Обработка текстов
│   ├── tfidf_vectorizer.py # Векторизатор TF-IDF
│   └── vectorizer.py      # Базовый класс векторизатора
├── tests/                 # Тесты
├── database/             # База данных
├── input/                # Входные данные
├── data/                 # Данные
├── frontend/             # Фронтенд
├── main.py               # Точка входа
├── requirements.txt      # Зависимости
└── README.md            # Описание проекта
```

## Основные модули

### main.py
Основной скрипт запуска приложения. Выполняет:
- Проверку зависимостей
- Настройку NLTK
- Запуск обработки данных (полный цикл или частичный)

### src/data_processor.py
Модуль для полного цикла обработки данных:
- Инициализация базы данных
- Загрузка данных
- Обработка текстов
- Векторизация

### src/data_loader.py
Модуль для загрузки данных в базу данных:
- Загрузка компетенций
- Загрузка трудовых функций
- Загрузка тем
- Загрузка дисциплин

### src/schema.py
Модуль для работы со схемой базы данных:
- Инициализация базы данных
- Сброс базы данных
- Обновление схемы

### src/text_processor.py
Модуль для обработки текстов:
- Нормализация текстов
- Удаление стоп-слов
- Обработка текстов в базе данных

### src/vectorizer.py
Модуль для векторизации текстов:
- Базовый класс векторизатора
- TF-IDF векторизация
- ruBERT векторизация

## Проверочные функции

Все проверочные функции находятся в директории `src/`:

- **check_data.py** — проверка загруженных данных:
  - Проверяет наличие и содержимое всех таблиц
  - Выводит количество записей и примеры данных

- **check_vectors.py** — проверка векторов:
  - Проверяет векторы тем и трудовых функций
  - Выводит размерность и примеры значений векторов
  - Проверяет корректность сохранения векторов

- **check_similarities.py** — проверка сходства:
  - Выводит статистику по сходству (количество пар, средние значения)
  - Показывает топ-N пар по TF-IDF и ruBERT сходству
  - Проверяет корректность расчета сходства

- **check_normalized_texts.py** — проверка нормализованных текстов:
  - Сравнивает оригинальные и нормализованные тексты
  - Проверяет корректность нормализации

## Запуск проверок

Все проверки можно запустить через `main.py`:

```bash
# Полный цикл обработки с проверками
python main.py --full-cycle

# Отдельные проверки
python -m src.check_data
python -m src.check_vectors
python -m src.check_similarities
python -m src.check_normalized_texts
```

## Связи компонентов проекта
- **topics** — учебные темы, связаны с **competencies** через таблицу **topic_competency**.
- **competencies** — компетенции, связаны с **topics** через таблицу **topic_competency**.
- **labor_functions** — трудовые функции, связаны с **labor_components** через таблицу **labor_function_components**.
- **labor_components** — универсальные компоненты, связаны с **labor_functions** через таблицу **labor_function_components**.
- **component_types** — типы компонентов, справочник.

## Файловая структура проекта
- **src/** — исходный код проекта:
  - **main.py** — основной скрипт для запуска проекта.
  - **text_processor.py** — обработка текста.
  - **check_data.py** — проверка загруженных данных.
  - **check_normalized_texts.py** — проверка нормализованных текстов.
  - **check_vectors.py** — проверка векторов.
  - **data_loader.py** — загрузка данных.
  - **schema.py** — схема базы данных.
  - **tfidf_vectorizer.py** — векторизация текста.
  - **vectorizer.py** — обёртка для работы с векторизаторами.
  - **download_nltk_data.py** — загрузка данных NLTK.
  - **db.py** — работа с базой данных.
- **tests/** — тесты:
  - **test_vectorization.py** — тесты векторизации.
  - **test_data.py** — тесты данных.
  - **test_text_processing.py** — тесты обработки текста.
  - **test_db.py** — тесты базы данных.
- **input/** — входные данные.
- **data/** — данные проекта.
- **database/** — база данных.
- **frontend/** — фронтенд.
- **venv/** — виртуальное окружение.
- **.cursor/** — настройки Cursor.
- **.git/** — Git.
- **.pytest_cache/** — кэш pytest.
- **requirements.txt** — зависимости проекта.
- **OVERVIEW.md** — цели, задачи, структура, стек.
- **DOCUMENTATION.md** — описание классов, функций, интерфейсов, БД.
- **TASKS.md** — статус выполнения задач.

# Описание классов, функций и интерфейсов
## Классы
- **TextProcessor** — класс для обработки текста (нормализация, удаление стоп-слов).
- **DatabaseTextProcessor** — класс для обработки текстов в базе данных.
- **TextVectorizer** — класс для векторизации текста с использованием TF-IDF.
- **DatabaseVectorizer** — класс для векторизации текстов в базе данных.
- **TestDataLoading** — класс для тестирования загрузки данных.
- **RuBertVectorizer** — класс для векторизации текстов с использованием модели ruBERT (sbert_large_nlu_ru).

## Функции
- **setup_nltk** — загрузка необходимых данных NLTK.
- **main** — основная функция запуска приложения.
- **get_db_connection** — получение соединения с базой данных.
- **init_db** — инициализация базы данных.
- **reset_db** — сброс базы данных.
- **download_nltk_resources** — загрузка необходимых ресурсов NLTK.
- **print_table_info** — вывод информации о количестве записей в таблице.
- **check_data** — проверка загруженных данных.
- **load_competencies** — загрузка компетенций из abilities.json.
- **load_labor_functions** — загрузка трудовых функций из prof_std.json.
- **load_topics** — загрузка тем из файлов в директории curriculum_disciplines.
- **load_all_data** — загрузка всех данных в базу данных.
- **check_vectors** — проверка векторов.

# Описание базы данных проекта
## Основные таблицы
| Таблица | Описание |
|---------|----------|
| `topics` | Учебные темы (название, часы, семестр) |
| `competencies` | Компетенции (код, категория, описание) |
| `labor_functions` | Трудовые функции (ID, уровень квалификации) |
| `labor_components` | Универсальные компоненты (действия/умения/знания) |
| `component_types` | Типы компонентов (справочник) |

## Таблицы связей
| Таблица | Назначение |
|---------|------------|
| `topic_competency` | Связь тем и компетенций |
| `labor_function_components` | Связь функций и компонентов |
| `topic_labor_function` | Результаты сопоставления (сходство) |

## Структура базы данных

### Таблицы

#### disciplines
Таблица для хранения информации о дисциплинах.
- `id` (INTEGER, PRIMARY KEY) - уникальный идентификатор дисциплины
- `name` (TEXT, NOT NULL) - название дисциплины
- `competencies` (TEXT) - компетенции дисциплины
- `goals` (TEXT) - цели дисциплины
- `tasks` (TEXT) - задачи дисциплины
- `nltk_normalized_name` (TEXT) - нормализованное название дисциплины
- `nltk_normalized_competencies` (TEXT) - нормализованные компетенции
- `nltk_normalized_goals` (TEXT) - нормализованные цели
- `nltk_normalized_tasks` (TEXT) - нормализованные задачи
- `rubert_vector` (BLOB) - векторное представление дисциплины

#### topics
Таблица для хранения тем дисциплин.
- `id` (INTEGER, PRIMARY KEY) - уникальный идентификатор темы
- `discipline_id` (INTEGER, FOREIGN KEY) - ссылка на дисциплину
- `title` (TEXT, NOT NULL) - название темы
- `description` (TEXT) - описание темы
- `nltk_normalized_title` (TEXT) - нормализованное название темы
- `nltk_normalized_description` (TEXT) - нормализованное описание темы
- `rubert_vector` (BLOB) - векторное представление темы

# Описание структуры фронтенда и API-роутов

## Структура фронтенда
- **index.html**: Главная страница с split-view интерфейсом.
  - Дроп-даун для выбора дисциплины.
  - Левая панель: таблица тем, связанных с выбранной дисциплиной.
  - Правая панель: таблица трудовых функций.
  - Слайдер для порога сходства (привязанный к оценке сходства по rubert).
  - Нижняя панель: рекомендательная информация.

## API-роуты
- **GET /api/disciplines**: Получение списка дисциплин.
- **GET /api/topics?discipline_id=...**: Получение тем по выбранной дисциплине.
- **GET /api/labor_functions**: Получение списка трудовых функций.
- **GET /api/similarities?topic_id=...&threshold=...**: Получение релевантных трудовых функций для выбранной темы (с учетом порога сходства по rubert).
- **GET /api/similarities?labor_function_id=...&threshold=...**: Получение релевантных тем для выбранной трудовой функции (с учетом порога сходства по rubert).

## Логика рекомендаций
- Если тема не обеспечивает трудовые функции (низкое сходство) — рекомендация "тема не обеспечивает трудовые функции".
- Если тема обеспечивает трудовые функции, но сходство низкое — рекомендация "рекомендуется уделить больше/меньше времени для изучения темы".
- Если тема имеет высокое сходство по rubert, но низкое по TF-IDF — рекомендация "возможно требуется перефразирование темы для лучшего текстового сходства".
- Если тема хорошо удовлетворяет трудовым функциям — положительная рекомендация.

# API Routes

## GET /api/disciplines
Возвращает список всех дисциплин.

**Response:**
```json
[
    {
        "id": 1,
        "name": "Название дисциплины"
    }
]
```

## GET /api/topics
Возвращает список тем для выбранной дисциплины.

**Parameters:**
- discipline_id (required): ID дисциплины

**Response:**
```json
[
    {
        "id": 1,
        "title": "Название темы",
        "description": "Описание темы"
    }
]
```

## GET /api/labor_functions
Возвращает список всех трудовых функций.

**Response:**
```json
[
    {
        "id": 1,
        "name": "Название трудовой функции"
    }
]
```

## GET /api/similarities
Возвращает сходство между темами и трудовыми функциями.

**Parameters:**
- topic_id или labor_function_id (один из параметров обязателен): ID темы или трудовой функции
- threshold (optional, default=0.5): Порог сходства

**Response:**
```json
{
    "results": [
        {
            "id": 1,
            "name": "Название",
            "similarity": 0.85
        }
    ],
    "recommendations": [
        "Текст рекомендации"
    ]
}
```

Возможные рекомендации:
- "Тема не обеспечивает трудовые функции" - если нет результатов выше порога
- "Рекомендуется уделить больше времени для изучения темы" - если среднее сходство < 0.7
- "Возможно требуется перефразирование темы для лучшего текстового сходства" - если ruBERT > 0.8, но TF-IDF < 0.3
- "Тема хорошо удовлетворяет трудовым функциям" - если среднее сходство > 0.8
